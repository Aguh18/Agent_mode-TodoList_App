<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Todo App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        padding: 2rem 0;
      }
      .register-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        padding: 2rem;
        max-width: 500px;
        width: 100%;
      }
      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      }
      .password-strength {
        height: 5px;
        border-radius: 3px;
        margin-top: 5px;
      }
      .strength-weak {
        background-color: #dc3545;
      }
      .strength-medium {
        background-color: #ffc107;
      }
      .strength-strong {
        background-color: #28a745;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="register-card">
            <div class="text-center mb-4">
              <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
              <h3 class="fw-bold">Create Account</h3>
              <p class="text-muted">Join us and start managing your todos</p>
            </div>

            <div id="alert-container"></div>

            <form id="registerForm">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="username" class="form-label">Username</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="fas fa-user"></i>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      id="username"
                      name="username"
                      required
                    />
                  </div>
                  <div class="form-text">Choose a unique username</div>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="fas fa-envelope"></i>
                    </span>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                    />
                  </div>
                  <div class="form-text">Optional but recommended</div>
                </div>
              </div>

              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="fas fa-lock"></i>
                  </span>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    required
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="togglePassword"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="password-strength" id="passwordStrength"></div>
                <div class="form-text" id="passwordHelp">
                  Use at least 8 characters with mix of letters and numbers
                </div>
              </div>

              <div class="mb-3">
                <label for="confirmPassword" class="form-label"
                  >Confirm Password</label
                >
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="fas fa-lock"></i>
                  </span>
                  <input
                    type="password"
                    class="form-control"
                    id="confirmPassword"
                    name="confirmPassword"
                    required
                  />
                  <span class="input-group-text" id="passwordMatch">
                    <i
                      class="fas fa-times text-danger d-none"
                      id="passwordMismatch"
                    ></i>
                    <i
                      class="fas fa-check text-success d-none"
                      id="passwordMatched"
                    ></i>
                  </span>
                </div>
              </div>

              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="agreeTerms"
                  required
                />
                <label class="form-check-label" for="agreeTerms">
                  I agree to the
                  <a href="#" class="text-decoration-none">Terms of Service</a>
                  and
                  <a href="#" class="text-decoration-none">Privacy Policy</a>
                </label>
              </div>

              <div class="d-grid mb-3">
                <button
                  type="submit"
                  class="btn btn-primary btn-lg"
                  id="registerBtn"
                >
                  <span
                    class="spinner-border spinner-border-sm d-none"
                    id="registerSpinner"
                  ></span>
                  Create Account
                </button>
              </div>
            </form>

            <div class="text-center">
              <p class="text-muted">
                Already have an account?
                <a href="/login" class="text-decoration-none fw-bold"
                  >Sign in here</a
                >
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Toggle password visibility
      document
        .getElementById("togglePassword")
        .addEventListener("click", function () {
          const password = document.getElementById("password");
          const icon = this.querySelector("i");

          if (password.type === "password") {
            password.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash");
          } else {
            password.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
          }
        });

      // Password strength checker
      document
        .getElementById("password")
        .addEventListener("input", function () {
          const password = this.value;
          const strengthBar = document.getElementById("passwordStrength");
          const helpText = document.getElementById("passwordHelp");

          let strength = 0;
          if (password.length >= 8) strength++;
          if (/[a-z]/.test(password)) strength++;
          if (/[A-Z]/.test(password)) strength++;
          if (/[0-9]/.test(password)) strength++;
          if (/[^A-Za-z0-9]/.test(password)) strength++;

          strengthBar.className = "password-strength";
          if (strength < 3) {
            strengthBar.classList.add("strength-weak");
            helpText.textContent =
              "Weak password. Add more characters and variety.";
            helpText.className = "form-text text-danger";
          } else if (strength < 4) {
            strengthBar.classList.add("strength-medium");
            helpText.textContent =
              "Medium strength. Consider adding special characters.";
            helpText.className = "form-text text-warning";
          } else {
            strengthBar.classList.add("strength-strong");
            helpText.textContent = "Strong password!";
            helpText.className = "form-text text-success";
          }
        });

      // Password confirmation checker
      function checkPasswordMatch() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const mismatch = document.getElementById("passwordMismatch");
        const matched = document.getElementById("passwordMatched");

        if (confirmPassword && password !== confirmPassword) {
          mismatch.classList.remove("d-none");
          matched.classList.add("d-none");
        } else if (confirmPassword && password === confirmPassword) {
          mismatch.classList.add("d-none");
          matched.classList.remove("d-none");
        } else {
          mismatch.classList.add("d-none");
          matched.classList.add("d-none");
        }
      }

      document
        .getElementById("password")
        .addEventListener("input", checkPasswordMatch);
      document
        .getElementById("confirmPassword")
        .addEventListener("input", checkPasswordMatch);

      // Register form submission
      document
        .getElementById("registerForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const registerBtn = document.getElementById("registerBtn");
          const registerSpinner = document.getElementById("registerSpinner");
          const alertContainer = document.getElementById("alert-container");

          // Validate passwords match
          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (password !== confirmPassword) {
            alertContainer.innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-circle"></i> Passwords do not match!
                    </div>
                `;
            return;
          }

          // Show loading state
          registerSpinner.classList.remove("d-none");
          registerBtn.disabled = true;

          const formData = {
            username: document.getElementById("username").value,
            email: document.getElementById("email").value,
            password: password,
          };

          try {
            const response = await fetch("/api/auth/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const result = await response.json();

            if (result.success) {
              // Show success message
              alertContainer.innerHTML = `
                        <div class="alert alert-success" role="alert">
                            <i class="fas fa-check-circle"></i> Account created successfully! Redirecting to login...
                        </div>
                    `;

              // Redirect to login
              setTimeout(() => {
                window.location.href = "/login";
              }, 2000);
            } else {
              // Show error message
              alertContainer.innerHTML = `
                        <div class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-circle"></i> ${result.message}
                        </div>
                    `;
            }
          } catch (error) {
            alertContainer.innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-circle"></i> An error occurred. Please try again.
                    </div>
                `;
          } finally {
            // Hide loading state
            registerSpinner.classList.add("d-none");
            registerBtn.disabled = false;
          }
        });
    </script>
  </body>
</html>
